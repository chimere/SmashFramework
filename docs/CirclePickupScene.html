<!DOCTYPE html>  <html> <head>   <title>CirclePickupScene.as</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">        <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                   <b> 1. First Steps </b>                          <a class="source" href="PBEDemos.html">       PBEDemos.as      </a>                          <a class="source" href="SimplestRendererScene.html">       SimplestRendererScene.as      </a>                          <a class="source" href="SimplestSpriteRenderer.html">       SimplestSpriteRenderer.as      </a>                          <a class="source" href="BindingDemoScene.html">       BindingDemoScene.as      </a>                          <a class="source" href="SimplestSpatialComponent.html">       SimplestSpatialComponent.as      </a>                          <a class="source" href="MouseFollowerScene.html">       MouseFollowerScene.as      </a>                          <a class="source" href="SimplestMouseFollowComponent.html">       SimplestMouseFollowComponent.as      </a>                          <a class="source" href="CirclePickupScene.html">       CirclePickupScene.as      </a>                          <a class="source" href="GemManager.html">       GemManager.as      </a>                          <b> 2. Building Gameplay </b>                          <a class="source" href="CirclePickupWithTimeManagerScene.html">       CirclePickupWithTimeManagerScene.as      </a>                          <a class="source" href="OneButtonDemoScene.html">       OneButtonDemoScene.as      </a>                          <a class="source" href="OneButtonWithTweenDemoScene.html">       OneButtonWithTweenDemoScene.as      </a>                          <a class="source" href="TwoButtonDemoScene.html">       TwoButtonDemoScene.as      </a>                          <a class="source" href="CarDemoScene.html">       CarDemoScene.as      </a>                          <a class="source" href="FSMDemoScene.html">       FSMDemoScene.as      </a>                               </div>         </div>       </div>      <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs" colspan="2">             <h1>               CirclePickupScene.as             </h1>           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>The Circle Pickup demo is our first taste of simple gameplay - move
the mouse to pick up objects in the game world. It demonstrates adding your
own manager to the game and how to use PBSet to keep track of active game
objects. It also shows a more complex game object setup.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">package</span> <span class="nx">demos</span><span class="p">.</span><span class="nx">demo_04_circlePickup</span>
<span class="p">{</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBGameObject</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBGroup</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBSet</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simplest</span><span class="p">.</span><span class="nx">SimplestMouseFollowComponent</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simplest</span><span class="p">.</span><span class="nx">SimplestSpatialComponent</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simplest</span><span class="p">.</span><span class="nx">SimplestSpriteRenderer</span><span class="o">;</span>
    
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nb">Stage</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nb">Event</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">geom</span><span class="p">.</span><span class="nb">Point</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">demos</span><span class="p">.</span><span class="nx">SimplestDemoGameObject</span><span class="o">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Implementation</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">CirclePickupScene</span> <span class="kd">extends</span> <span class="nx">PBGroup</span>
    <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>PBSet for tracking active gems. Gems are the circles that we can pick
up. Remember, a set holds references to only living objects. When
an object is destroy()ed, it is removed from any sets that reference
it. So it's a great way to track of which gems are still alive. </p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="k">var</span> <span class="nx">gemSet</span><span class="o">:</span><span class="nx">PBSet</span><span class="o">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This manager keeps track of the active circles, and is responsible
for destroy()ing them then we pick them up (by getting close). See
the comments in the GemManager for more information on managers in
PBE. </p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="k">var</span> <span class="nx">gemManager</span><span class="o">:</span><span class="nx">GemManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GemManager</span><span class="p">();</span>
        </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>We'll need a reference to the Stage. Get it via dependency
injection, as usual.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">[</span><span class="nx">Inject</span><span class="p">]</span>
        <span class="kd">public</span> <span class="k">var</span> <span class="nx">stage</span><span class="o">:</span><span class="nb">Stage</span><span class="o">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Setup</h2>

<p>You'll notice we have many more methods in this demo. It's our first
demo to resemble a real game, so there is more complexity. Don't
worry - all of the code here is very focused on making our game, and
we'll walk through it one step at a time.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">override</span> <span class="kd">function</span> <span class="nx">initialize</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span>
            <span class="kd">super</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Set up the PBSet for the gems.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">gemSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PBSet</span><span class="p">();</span>
            <span class="nx">gemSet</span><span class="p">.</span><span class="nx">owningGroup</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="nx">gemSet</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Tell the gem manager what set of objects to consider for 
picking up.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">gemManager</span><span class="p">.</span><span class="nx">gemSet</span> <span class="o">=</span> <span class="nx">gemSet</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Make the guy that follows the mouse and pick stuff up.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">gemManager</span><span class="p">.</span><span class="nx">pickerUpper</span> <span class="o">=</span> <span class="nx">makeMouseFollower</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Make the gems.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">for</span><span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
                <span class="nx">makeGem</span><span class="p">(</span><span class="k">new</span> <span class="nb">Point</span><span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">stageWidth</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">,</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">stageHeight</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()));</span>
            </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>And, run a little bit of our own logic every frame.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">stage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nb">Event</span><span class="p">.</span><span class="nx">ENTER_FRAME</span><span class="o">,</span> <span class="nx">onFrame</span><span class="p">);</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>Teardown</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">override</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Only thing to clean up is the event listener. All the game
objects are owned by this group (remember, we subclass PBGroup)
so they will be cleaned up by the parent class logic.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">stage</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nb">Event</span><span class="p">.</span><span class="nx">ENTER_FRAME</span><span class="o">,</span> <span class="nx">onFrame</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Always pass control to the parent class.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">super</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>ENTER_FRAME Handler</h2>

<p>Let the gem pick-up manager process every frame.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">onFrame</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="nb">Event</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span>
            <span class="nx">gemManager</span><span class="p">.</span><span class="nx">process</span><span class="p">();</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Make MouseFollower</h2>

<p>We have a method for each object type. This one is for making mouse
followers, game objects that follow the mouse around. We explain this
in detail in the MouseFollowerScene, it is a copy of the code there.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">makeMouseFollower</span><span class="p">()</span><span class="o">:</span><span class="nx">SimplestDemoGameObject</span>
        <span class="p">{</span>
            <span class="k">var</span> <span class="nx">go</span><span class="o">:</span><span class="nx">SimplestDemoGameObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestDemoGameObject</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">owningGroup</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Create and add the spatial component.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">go</span><span class="p">.</span><span class="nx">spatial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestSpatialComponent</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Create and add the rendering component, and bind its position
to the spatial component.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestSpriteRenderer</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">addBinding</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="o">,</span> <span class="s2">&quot;@spatial.position&quot;</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Finally, create the mouse following component. Notice we don't
have a slot on the SimplestDemoGameObject class for it, so we
add it via addComponent. It'll update the spatial's position as
the mouse moves.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">const</span> <span class="nx">mfc</span><span class="o">:</span><span class="nx">SimplestMouseFollowComponent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestMouseFollowComponent</span><span class="p">();</span>
            <span class="nx">mfc</span><span class="p">.</span><span class="nx">targetProperty</span> <span class="o">=</span> <span class="s2">&quot;@spatial.position&quot;</span><span class="o">;</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">mfc</span><span class="o">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Finally, get the GO going.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">go</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            
            <span class="k">return</span> <span class="nx">go</span><span class="o">;</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h2>Make Gem</h2>

<p>Create a gem at a given point. Gems are identical to the game
object we created in the BindingDemoScene. The only difference
is that we set the position based on the pos parameter, and
we also add them to the gems PBSet.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">makeGem</span><span class="p">(</span><span class="nx">pos</span><span class="o">:</span><span class="nb">Point</span><span class="p">)</span><span class="o">:</span><span class="nx">SimplestDemoGameObject</span>
        <span class="p">{</span>
            <span class="k">var</span> <span class="nx">go</span><span class="o">:</span><span class="nx">SimplestDemoGameObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestDemoGameObject</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">owningGroup</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">spatial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestSpatialComponent</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">spatial</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestSpriteRenderer</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">addBinding</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="o">,</span> <span class="s2">&quot;@spatial.position&quot;</span><span class="p">);</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span> 
            </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Add it to the set of gems so we can easily keep track of it. The
gem set will keep a reference to it as long as it is alive, ie, 
destroy() has not been called.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">gemSet</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">go</span><span class="p">);</span>
            
            <span class="k">return</span> <span class="nx">go</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// @docco-chapter 1. First Steps</span>
<span class="c1">// @docco-order 8</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 