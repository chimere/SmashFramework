<!DOCTYPE html>  <html> <head>   <title>CirclePickupWithTimeManagerScene.as</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">        <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                   <b> 1. First Steps </b>                          <a class="source" href="PBEDemos.html">       PBEDemos.as      </a>                          <a class="source" href="SimplestRendererScene.html">       SimplestRendererScene.as      </a>                          <a class="source" href="SimplestSpriteRenderer.html">       SimplestSpriteRenderer.as      </a>                          <a class="source" href="BindingDemoScene.html">       BindingDemoScene.as      </a>                          <a class="source" href="SimplestSpatialComponent.html">       SimplestSpatialComponent.as      </a>                          <a class="source" href="MouseFollowerScene.html">       MouseFollowerScene.as      </a>                          <a class="source" href="SimplestMouseFollowComponent.html">       SimplestMouseFollowComponent.as      </a>                          <a class="source" href="CirclePickupScene.html">       CirclePickupScene.as      </a>                          <a class="source" href="GemManager.html">       GemManager.as      </a>                          <b> 2. Building Gameplay </b>                          <a class="source" href="CirclePickupWithTimeManagerScene.html">       CirclePickupWithTimeManagerScene.as      </a>                          <a class="source" href="OneButtonDemoScene.html">       OneButtonDemoScene.as      </a>                          <a class="source" href="OneButtonWithTweenDemoScene.html">       OneButtonWithTweenDemoScene.as      </a>                          <a class="source" href="TwoButtonDemoScene.html">       TwoButtonDemoScene.as      </a>                          <a class="source" href="CarDemoScene.html">       CarDemoScene.as      </a>                          <a class="source" href="FSMDemoScene.html">       FSMDemoScene.as      </a>                               </div>         </div>       </div>      <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs" colspan="2">             <h1>               CirclePickupWithTimeManagerScene.as             </h1>           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This demo is identical to the CirclePickupScene, but shows how we can use
the TimeManager instead of directly listening for ENTER_FRAME events.</p>

<p>Why would we want to do this?</p>

<p>Because the TimeManager gives us a better model for building our game's
simulation, one that works more reliably even if the game is running slow
or fast. It gives us two kinds of callbacks, ticks and frames. Ticks are
guaranteed to be run at 32Hz, so they are a good basis for building game
logic. Frames are called every time Flash renders, so they let us do
visual rendering in a specific place.</p>

<p>Using the TimeManager, we can also pause, slow down, or speed up our game's
logic without having to worry about our rendering code getting in the way.</p>

<p>The TimeManager also lets us assign a priority to things that listen to
frames or ticks, so that we can e.g. make sure scene rendering code
is run after all the individual bits of logic that update the positions
of all the things in the scene.</p>

<p>To demonstrate how this is handy, we get rid of the GemManager, and fold
its code right into the scene by implementing the ITicked interface and
adding ourselves to the TimeManager.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">package</span> <span class="nx">demos</span><span class="p">.</span><span class="nx">demo_05_circlePickupWithTimeManager</span>
<span class="p">{</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBGameObject</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBGroup</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBSet</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simpler</span><span class="p">.</span><span class="nx">MouseFollowComponent</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simpler</span><span class="p">.</span><span class="nx">SimpleSpriteRenderer</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simplest</span><span class="p">.</span><span class="nx">SimplestSpatialComponent</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">ITicked</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">time</span><span class="p">.</span><span class="nx">TimeManager</span><span class="o">;</span>
    
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nb">Stage</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nb">Event</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">geom</span><span class="p">.</span><span class="nb">Point</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">demos</span><span class="p">.</span><span class="nx">SimpleDemoGameObject</span><span class="o">;</span>
    </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Implementation</h2>

<p>Notice we implement ITicked so that we can add ourselves to the 
TimeManager directly.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">CirclePickupWithTimeManagerScene</span> <span class="kd">extends</span> <span class="nx">PBGroup</span> <span class="kd">implements</span> <span class="nx">ITicked</span>
    <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>You will recognize this code from the GemManager in the previous
demo.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="k">var</span> <span class="nx">gemSet</span><span class="o">:</span><span class="nx">PBSet</span><span class="o">;</span>
        <span class="kd">public</span> <span class="k">var</span> <span class="nx">pickerUpper</span><span class="o">:</span><span class="nx">SimpleDemoGameObject</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kd">const</span> <span class="nx">collisionRadius</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="mi">35</span><span class="o">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>And this is the same as what's in the CiclePickupScene.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">[</span><span class="nx">Inject</span><span class="p">]</span>
        <span class="kd">public</span> <span class="k">var</span> <span class="nx">stage</span><span class="o">:</span><span class="nb">Stage</span><span class="o">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Get the root group's TimeManager (instantiated in PBEDemos.as). The
TimeManager provides callbacks as frames and ticks occur, lets you 
schedule callbacks, allows scaling/pausing time, and does all this 
much more cheaply than the usual event listener/setTimeout patterns
found in AS3 projects.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">[</span><span class="nx">Inject</span><span class="p">]</span>
        <span class="kd">public</span> <span class="k">var</span> <span class="nx">timeManager</span><span class="o">:</span><span class="nx">TimeManager</span><span class="o">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Initialize Demo</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">override</span> <span class="kd">function</span> <span class="nx">initialize</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span>
            <span class="kd">super</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Set up the PBSet for the gems.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">gemSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PBSet</span><span class="p">();</span>
            <span class="nx">gemSet</span><span class="p">.</span><span class="nx">owningGroup</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="nx">gemSet</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Make the guy that follows the mouse.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">pickerUpper</span> <span class="o">=</span> <span class="nx">makeMouseFollower</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Make the gems.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">for</span><span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
                <span class="nx">makeGem</span><span class="p">(</span><span class="k">new</span> <span class="nb">Point</span><span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">stageWidth</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">,</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">stageHeight</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()));</span>
            </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>We add ourselves to the TimeManager, so that it will tick us.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">timeManager</span><span class="p">.</span><span class="nx">addTickedObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h2>Tear Down Demo</h2>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">override</span> <span class="kd">function</span> <span class="nx">destroy</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span>
            <span class="nx">timeManager</span><span class="p">.</span><span class="nx">removeTickedObject</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            
            <span class="kd">super</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>Tick Handler</h2>

<p>Called by the TimeManager 32 times per second. Ideal place to run
our game logic.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">onTick</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Find all circles within 20px of the pickerupper
and destroy() them.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">const</span> <span class="nx">pickerPos</span><span class="o">:</span><span class="nb">Point</span> <span class="o">=</span> <span class="nx">pickerUpper</span><span class="p">.</span><span class="nx">spatial</span><span class="p">.</span><span class="nx">position</span><span class="o">;</span>
            
            <span class="k">for</span><span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">gemSet</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>See if it's in range.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="kd">const</span> <span class="nx">circle</span><span class="o">:</span><span class="nx">SimpleDemoGameObject</span> <span class="o">=</span> <span class="nx">gemSet</span><span class="p">.</span><span class="nx">getPBObjectAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">SimpleDemoGameObject</span><span class="o">;</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">Point</span><span class="p">.</span><span class="nx">distance</span><span class="p">(</span><span class="nx">circle</span><span class="p">.</span><span class="nx">spatial</span><span class="p">.</span><span class="nx">position</span><span class="o">,</span> <span class="nx">pickerPos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">collisionRadius</span><span class="p">)</span>
                    <span class="k">continue</span><span class="o">;</span>
                </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Nuke it! And decrement i so we don't skip any.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">circle</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
                <span class="nx">i</span><span class="o">--;</span>
            <span class="p">}</span>
        <span class="p">}</span> 
        </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h2>Make Mouse Follower</h2>

<p>Creates the mouse follower game object. Same as in previous demos.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">makeMouseFollower</span><span class="p">()</span><span class="o">:</span><span class="nx">SimpleDemoGameObject</span>
        <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Create the mouse follower.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">var</span> <span class="nx">go</span><span class="o">:</span><span class="nx">SimpleDemoGameObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleDemoGameObject</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">owningGroup</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">spatial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestSpatialComponent</span><span class="p">();</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleSpriteRenderer</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">addBinding</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="o">,</span> <span class="s2">&quot;@spatial.position&quot;</span><span class="p">);</span>
            
            <span class="kd">const</span> <span class="nx">mfc</span><span class="o">:</span><span class="nx">MouseFollowComponent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MouseFollowComponent</span><span class="p">();</span>
            <span class="nx">mfc</span><span class="p">.</span><span class="nx">targetProperty</span> <span class="o">=</span> <span class="s2">&quot;@spatial.position&quot;</span><span class="o">;</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">addComponent</span><span class="p">(</span><span class="nx">mfc</span><span class="o">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">);</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span>
            
            <span class="k">return</span> <span class="nx">go</span><span class="o">;</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Make Gem</h2>

<p>Creates the gem game object. Same as in previous demos.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">makeGem</span><span class="p">(</span><span class="nx">pos</span><span class="o">:</span><span class="nb">Point</span><span class="p">)</span><span class="o">:</span><span class="nx">SimpleDemoGameObject</span>
        <span class="p">{</span>
            <span class="k">var</span> <span class="nx">go</span><span class="o">:</span><span class="nx">SimpleDemoGameObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleDemoGameObject</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">owningGroup</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">spatial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimplestSpatialComponent</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">spatial</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleSpriteRenderer</span><span class="p">();</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">addBinding</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="o">,</span> <span class="s2">&quot;@spatial.position&quot;</span><span class="p">);</span>
            
            <span class="nx">go</span><span class="p">.</span><span class="nx">initialize</span><span class="p">();</span> 
            </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Don't forget to add it to the gem set!</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">gemSet</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">go</span><span class="p">);</span>
            
            <span class="k">return</span> <span class="nx">go</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// @docco-chapter 2. Building Gameplay</span>
<span class="c1">// @docco-order 1</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 