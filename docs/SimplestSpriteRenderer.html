<!DOCTYPE html>  <html> <head>   <title>SimplestSpriteRenderer.as</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">        <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                   <b> 1. First Steps </b>                          <a class="source" href="PBEDemos.html">       PBEDemos.as      </a>                          <a class="source" href="SimplestRendererScene.html">       SimplestRendererScene.as      </a>                          <a class="source" href="SimplestSpriteRenderer.html">       SimplestSpriteRenderer.as      </a>                          <a class="source" href="BindingDemoScene.html">       BindingDemoScene.as      </a>                          <a class="source" href="SimplestSpatialComponent.html">       SimplestSpatialComponent.as      </a>                          <a class="source" href="MouseFollowerScene.html">       MouseFollowerScene.as      </a>                          <a class="source" href="SimplestMouseFollowComponent.html">       SimplestMouseFollowComponent.as      </a>                          <a class="source" href="CirclePickupScene.html">       CirclePickupScene.as      </a>                          <a class="source" href="GemManager.html">       GemManager.as      </a>                          <b> 2. Building Gameplay </b>                          <a class="source" href="CirclePickupWithTimeManagerScene.html">       CirclePickupWithTimeManagerScene.as      </a>                          <a class="source" href="OneButtonDemoScene.html">       OneButtonDemoScene.as      </a>                          <a class="source" href="OneButtonWithTweenDemoScene.html">       OneButtonWithTweenDemoScene.as      </a>                          <a class="source" href="TwoButtonDemoScene.html">       TwoButtonDemoScene.as      </a>                          <a class="source" href="CarDemoScene.html">       CarDemoScene.as      </a>                          <a class="source" href="FSMDemoScene.html">       FSMDemoScene.as      </a>                               </div>         </div>       </div>      <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs" colspan="2">             <h1>               SimplestSpriteRenderer.as             </h1>           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Many games have very complex rendering systems.</p>

<p>But rendering in Flash can be really simple. All you need is a 
DisplayObject, like a Sprite. SimplestRendererScene puts a Sprite with a
circle in it on the stage, and makes it easy to control the position.</p>

<p>You could think of SimplestSpriteRenderer as being a "view" in an MVC
context.</p>

<p>This component demonstrates three important parts of PBE:</p>

<ol>
<li><strong>Component lifecycle.</strong> Components have onAdd called when they 
are added to a PBGameObject, and onRemove called when they are
are removed. They are automatically removed when the PBGameObject
is destroy()ed. So they are ideal for doing setup/teardown of
your component. We use them here to add and remove the Sprite to
the Stage.</li>
<li><strong>Dependency injection.</strong> Values registered with the owning
PBGroup are available for injection. Injection is really simple,
you just make a public var of the type you want and annotate it
with [Inject]. When the component is added to a PBGameObject,
the PBGameObject automatically does injection using its owning
PBGroup. We use this to get at the Stage we should be using.</li>
<li><strong>Data bindings.</strong> Many application frameworks (like Flex/MXML)
allow you to automatically pull data from one place in your app
to another. In PBE, every component has a list of "bindings" -
sources to pull data into the component. We'll discuss bindings
in more detail elsewhere, but it's important to call
applyBindings() to make sure they are applied before your
component does per-tick or per-frame processing.</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">package</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">simplest</span>
<span class="p">{</span>
    <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">pblabs</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">PBComponent</span><span class="o">;</span>
    
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nb">Sprite</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="nb">Stage</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nb">Event</span><span class="o">;</span>
    <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">geom</span><span class="p">.</span><span class="nb">Point</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>SimplestSpriteRenderer</h2>

<p>Every component inherits from PBComponent. Beyond that, everything
a component can do is optional.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">public</span> <span class="kd">class</span> <span class="nx">SimplestSpriteRenderer</span> <span class="kd">extends</span> <span class="nx">PBComponent</span>
    <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The Sprite instance we'll manage.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="k">var</span> <span class="nx">sprite</span><span class="o">:</span><span class="nb">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Sprite</span><span class="p">();</span>
        </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>We also want to have our own storage for the position, so that we're
not constantly touching the Sprite.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">protected</span> <span class="k">var</span> <span class="nx">_position</span><span class="o">:</span><span class="nb">Point</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Point</span><span class="p">();</span>
        </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Any public variable with [Inject] before it will be injected. stage
requires an instance of Stage be available; if one is not 
registered on the PBGroup that this component's PBGameObject belongs
to, then you'll get an error when you try to initialize this 
component.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">[</span><span class="nx">Inject</span><span class="p">]</span>
        <span class="kd">public</span> <span class="k">var</span> <span class="nx">stage</span><span class="o">:</span><span class="nb">Stage</span><span class="o">;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Position</h2>

<p>The main property we track in this renderer is position. A more
complex renderer might also store rotation, scale, skew, and so on.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="nx">position</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="nb">Point</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>We copy the Point to avoid bugs; it's easy to say
   renderer.position = somePoint;
   somePoint.y = 10;
which would result in modifying the Point that renderer is
referencing.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">_position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">x</span><span class="o">;</span>
            <span class="nx">_position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">y</span><span class="o">;</span>
            </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Update the Sprite's position to match.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">sprite</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">x</span><span class="o">;</span>
            <span class="nx">sprite</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">y</span><span class="o">;</span>            
        <span class="p">}</span>
        
        <span class="kd">public</span> <span class="kd">function</span> <span class="kd">get</span> <span class="nx">position</span><span class="p">()</span><span class="o">:</span><span class="nb">Point</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nx">_position</span><span class="o">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Initialization and Destruction</h2>

<p>onAdd and onRemove are called by PBE when a component is added or
removed from a PBGameObject. They are the best places to do startup
and shutdown logic. The constructor is not as good of a place,
because injection won't have happened and if the user is setting
any properties on the component, they can't be set till after the
constructor is called.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">protected</span> <span class="kd">override</span> <span class="kd">function</span> <span class="nx">onAdd</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Always call the super class' onAdd to make sure the component
is fully initialized.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">super</span><span class="p">.</span><span class="nx">onAdd</span><span class="p">();</span>
            </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Prepare the graphics in the sprite - we'll draw a simple circle.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">sprite</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineStyle</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="nx">sprite</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginFill</span><span class="p">(</span><span class="mi">0</span><span class="nx">xFF00FF</span><span class="p">);</span>
            <span class="nx">sprite</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawCircle</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">20</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>A more advanced component might use ProcessManager, but we'll
just subscribe to ENTER_FRAME.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">stage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nb">Event</span><span class="p">.</span><span class="nx">ENTER_FRAME</span><span class="o">,</span> <span class="nx">onFrame</span><span class="p">);</span>
            </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Add the sprite to the stage (which is provided by dependency
injection).</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">stage</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>In onRemove, you want to undo the actions in onAdd - so we
remove the sprite from the stage and unsubscribe from our 
ENTER_FRAME listener.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">protected</span> <span class="kd">override</span> <span class="kd">function</span> <span class="nx">onRemove</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span>
            <span class="nx">stage</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
            <span class="nx">stage</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nb">Event</span><span class="p">.</span><span class="nx">ENTER_FRAME</span><span class="o">,</span> <span class="nx">onFrame</span><span class="p">);</span>
            
            <span class="kd">super</span><span class="p">.</span><span class="nx">onRemove</span><span class="p">();</span>
        <span class="p">}</span>
        </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Frame Callback</h2>

<p>The basis of animation is updating your visuals every frame. This
callback doesn't need to do anything, because the renderer isn't
intrinsically animated (generally another component will tell it
how to move). But we want to support data binding, so we make sure
to call applyBindings() every frame, in case we have a binding that
updates our position.</p>

<p>applyBindings() is very cheap if no bindings are present, so while
you don't want to call it more than you have to, you only pay for 
what you use.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">public</span> <span class="kd">function</span> <span class="nx">onFrame</span><span class="p">(</span><span class="nx">e</span><span class="o">:*</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span>
        <span class="p">{</span>
            <span class="nx">applyBindings</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// @docco-chapter 1. First Steps</span>
<span class="c1">// @docco-order 3</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 